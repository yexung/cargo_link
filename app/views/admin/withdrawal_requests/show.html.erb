<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- 헤더 -->
    <div class="mb-8">
      <%= link_to "← 환전 신청 관리", admin_withdrawal_requests_path, 
          class: "text-blue-600 hover:text-blue-800" %>
      <h1 class="text-3xl font-bold text-gray-900 mt-4">환전 신청 상세</h1>
      <p class="mt-2 text-gray-600">환전 신청을 검토하고 승인 또는 거부하세요</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- 환전 신청 정보 -->
      <div class="lg:col-span-2 space-y-6">
        <!-- 신청자 정보 -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">신청자 정보</h2>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <span class="text-sm text-gray-600">이름</span>
              <p class="font-medium text-gray-900"><%= @withdrawal_request.seller.name %></p>
            </div>
            <div>
              <span class="text-sm text-gray-600">회사명</span>
              <p class="font-medium text-gray-900"><%= @withdrawal_request.seller.company_name %></p>
            </div>
            <div>
              <span class="text-sm text-gray-600">연락처</span>
              <p class="font-medium text-gray-900"><%= @withdrawal_request.seller.phone %></p>
            </div>
            <div>
              <span class="text-sm text-gray-600">이메일</span>
              <p class="font-medium text-gray-900"><%= @withdrawal_request.seller.email %></p>
            </div>
            <div>
              <span class="text-sm text-gray-600">현재 잔고</span>
              <p class="font-medium text-blue-600"><%= @withdrawal_request.seller.formatted_balance %></p>
            </div>
            <div>
              <span class="text-sm text-gray-600">총 판매 수익</span>
              <p class="font-medium text-green-600">
                <%= number_with_delimiter(@withdrawal_request.seller.total_earnings.to_i) %>원
              </p>
            </div>
          </div>
        </div>

        <!-- 환전 신청 정보 -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">환전 신청 정보</h2>
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <span class="text-sm text-gray-600">신청 금액</span>
                <p class="text-2xl font-bold text-blue-600"><%= @withdrawal_request.formatted_amount %></p>
              </div>
              <div>
                <span class="text-sm text-gray-600">신청 일시</span>
                <p class="font-medium text-gray-900">
                  <%= @withdrawal_request.requested_at.strftime("%Y년 %m월 %d일 %H시 %M분") %>
                </p>
              </div>
            </div>

            <div class="border-t pt-4">
              <h3 class="text-lg font-medium text-gray-900 mb-3">계좌 정보</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <span class="text-sm text-gray-600">은행명</span>
                  <p class="font-medium text-gray-900"><%= @withdrawal_request.bank_name %></p>
                </div>
                <div>
                  <span class="text-sm text-gray-600">계좌번호</span>
                  <p class="font-medium text-gray-900 font-mono"><%= @withdrawal_request.bank_account_number %></p>
                </div>
                <div>
                  <span class="text-sm text-gray-600">예금주명</span>
                  <p class="font-medium text-gray-900"><%= @withdrawal_request.account_holder_name %></p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 처리 내역 -->
        <% if @withdrawal_request.processed_at.present? %>
          <div class="bg-white rounded-lg shadow-sm border p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">처리 내역</h2>
            <div class="space-y-3">
              <div>
                <span class="text-sm text-gray-600">처리 일시</span>
                <p class="font-medium text-gray-900">
                  <%= @withdrawal_request.processed_at.strftime("%Y년 %m월 %d일 %H시 %M분") %>
                </p>
              </div>
              <% if @withdrawal_request.admin_memo.present? %>
                <div>
                  <span class="text-sm text-gray-600">관리자 메모</span>
                  <p class="font-medium text-gray-900 whitespace-pre-wrap"><%= @withdrawal_request.admin_memo %></p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- 처리 액션 -->
      <div class="space-y-6">
        <!-- 현재 상태 -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
          <h3 class="text-lg font-medium text-gray-900 mb-3">현재 상태</h3>
          <div class="text-center">
            <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full
              <%= case @withdrawal_request.status
                  when 'pending' then 'bg-yellow-100 text-yellow-800'
                  when 'approved' then 'bg-green-100 text-green-800'
                  when 'rejected' then 'bg-red-100 text-red-800'
                  end %>">
              <%= case @withdrawal_request.status
                  when 'pending' then '처리대기'
                  when 'approved' then '승인완료'
                  when 'rejected' then '거부됨'
                  end %>
            </span>
          </div>
        </div>

        <!-- 승인/거부 액션 -->
        <% if @withdrawal_request.pending? %>
          <div class="bg-white rounded-lg shadow-sm border p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">환전 처리</h3>
            
            <!-- 승인 -->
            <%= form_with url: approve_admin_withdrawal_request_path(@withdrawal_request), 
                method: :patch, local: true, class: "mb-4" do |form| %>
              <div class="mb-3">
                <%= form.label :admin_memo, "승인 메모 (선택사항)", 
                    class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_area :admin_memo, 
                    class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",
                    placeholder: "승인 관련 메모를 입력하세요 (선택사항)",
                    rows: 3 %>
              </div>
              <%= form.submit "승인", 
                  class: "w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700",
                  confirm: "정말로 이 환전 신청을 승인하시겠습니까?\n승인 시 판매자 잔고에서 #{@withdrawal_request.formatted_amount}이 차감됩니다." %>
            <% end %>

            <!-- 거부 -->
            <%= form_with url: reject_admin_withdrawal_request_path(@withdrawal_request), 
                method: :patch, local: true do |form| %>
              <div class="mb-3">
                <%= form.label :admin_memo, "거부 사유 (필수)", 
                    class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_area :admin_memo, 
                    class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",
                    placeholder: "거부 사유를 입력하세요",
                    rows: 3,
                    required: true %>
              </div>
              <%= form.submit "거부", 
                  class: "w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700",
                  confirm: "정말로 이 환전 신청을 거부하시겠습니까?" %>
            <% end %>
          </div>
        <% end %>

        <!-- 주의사항 -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <h3 class="text-sm font-medium text-yellow-800">처리 시 주의사항</h3>
          <ul class="mt-2 text-sm text-yellow-700 list-disc list-inside">
            <li>승인 시 판매자 잔고에서 신청 금액이 자동으로 차감됩니다</li>
            <li>처리된 환전 신청은 되돌릴 수 없습니다</li>
            <li>계좌 정보를 다시 한번 확인해주세요</li>
            <li>거부 시에는 반드시 사유를 명시해주세요</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
